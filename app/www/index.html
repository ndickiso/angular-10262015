<!DOCTYPE html>

<html>
	<head>
		<title>Welcome to Angular.js</title>
		<script src="libs/jquery/dist/jquery.js"></script>
		<script src="libs/angular/angular.js"></script>
		<script src="libs/angular-ui-router/release/angular-ui-router.js"></script>
	</head>

	<body>
		<div ng-app="MyApp">
			<div ui-view></div>
		</div>

		<script>

			angular.module("MyApp", ["ui.router"])
				.constant("WidgetsUrl", "/api/widgets")
				.config(function($stateProvider, $urlRouterProvider, $locationProvider) {

					$urlRouterProvider.otherwise("/");

					$stateProvider
						.state("home", {
							url: "/",
							controller: function(Widgets, $scope) {
								Widgets.getAll().then(function(results) {
									$scope.widgets = results.data;
								});
							},
							templateUrl: "/tpl/widget_list.html"
						})
						.state("view", {
							url: "/widgets/:widgetId",
						})
						.state("edit", {
							url: "/widgets/:widgetId/edit",
						});

				})
				.factory("Widgets", function($http, WidgetsUrl) {

					return {
						getAll: function() {
							return $http.get(WidgetsUrl);
						},
						get: function(widgetId) {
							return $http.get(WidgetsUrl +
								"/" + encodeURIComponent(widgetId));
						},
						create: function() {
							return $http.post(WidgetsUrl, widget);
						},
						update: function(widget) {
							return $http.put(WidgetsUrl +
								"/" + encodeURIComponent(widget.id), widget);
						},
						delete: function(widgetId) {
							return $http.delete(WidgetsUrl +
								"/" + encodeURIComponent(widgetId));
						}
					}

				});

		</script>
	</body>
</html>
